{
  "id": "14",
  "title": "Flooring Company ETL",
  "difficulty": "Medium",
  "category": "String Functions",
  "description": "**Flooring Company**\n\nYou have three DataFrames: `customers`, `orders`, and `products`.\n\n**customers:** customer_id, full_name, location\n**orders:** order_id, customer_id, product_id, quantity\n**products:** product_id, product_info\n\nSplit `full_name` into `first_name` and `last_name` columns.\nSplit `product_info` (format: \"type,color\") into `product_type` and `product_color`.\nJoin all three DataFrames.",
  "starter_code": "def etl(customers, orders, products):\n    # Write code here\n    pass",
  "test_setup": "from pyspark.sql import SparkSession\nfrom pyspark.sql import functions as F\nfrom pyspark.sql import Window as W\n\nspark = SparkSession.builder.appName('test').getOrCreate()\n\ncustomers_data = [('C1', 'John Doe', 'NYC'), ('C2', 'Jane Smith', 'LA')]\ncustomers = spark.createDataFrame(customers_data, ['customer_id', 'full_name', 'location'])\n\norders_data = [('O1', 'C1', 'P1', 10), ('O2', 'C2', 'P2', 5)]\norders = spark.createDataFrame(orders_data, ['order_id', 'customer_id', 'product_id', 'quantity'])\n\nproducts_data = [('P1', 'Hardwood,Oak'), ('P2', 'Tile,Marble')]\nproducts = spark.createDataFrame(products_data, ['product_id', 'product_info'])",
  "test_validation": "result = etl(customers, orders, products)\nassert result is not None, 'Function returned None'\nassert 'first_name' in result.columns, 'Missing first_name column'\nassert 'last_name' in result.columns, 'Missing last_name column'\nassert 'product_type' in result.columns, 'Missing product_type column'\nprint('âœ… TEST PASSED!')",
  "hints": [
    "Use F.split() to split strings into arrays",
    "Use getItem(index) to access array elements",
    "Drop intermediate columns after extraction"
  ],
  "solution": "def etl(customers, orders, products):\n    customers = customers.withColumn(\n        'split_name', F.split(customers['full_name'], ' ')\n    )\n    customers = customers.withColumn('first_name', customers['split_name'].getItem(0))\n    customers = customers.withColumn('last_name', customers['split_name'].getItem(1))\n    customers = customers.drop('split_name', 'full_name')\n    \n    products = products.withColumn(\n        'split_info', F.split(products['product_info'], ',')\n    )\n    products = products.withColumn('product_type', products['split_info'].getItem(0))\n    products = products.withColumn('product_color', products['split_info'].getItem(1))\n    products = products.drop('split_info', 'product_info')\n    \n    df = orders.join(customers, 'customer_id').join(products, 'product_id')\n    \n    return df"
}
